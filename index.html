<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.0.16/svg.min.js" integrity="sha512-p3Tp2zn+wApBreZCgRkmMwnfpN8MUPXzzOihXx7iGYXqE7t6m9drY8HeyMeeFuDWiTFKrGUrq3jpbT0vX6zY/Q==" crossorigin="anonymous"></script>
    <script src="trifold.js"></script>
  </head>
  <body onload="draw();">
    <section class="section">
      <h1 class="title is-1">Trifold Calculator</h1>

      <div class="columns">
        <div class="column is-one-third">
          <div class="field">
            <label class="label">Page Width</label>
            <div class="control">
              <input class="input" id="page-width-input" type="number" min="100" max="500" value="297" oninput="draw();"/>
            </div>
          </div>
          <div class="field">
            <label class="label">Page Height</label>
            <div class="control">
              <input class="input" id="page-height-input" type="number" min="100" max="500" value="210" oninput="draw();"/>
            </div>
          </div>
          <div class="field">
            <label class="label">Vertical Margin</label>
            <div class="control">
              <input class="input" id="margin-vertical-input" type="number" min="0" max="30" value="10" oninput="draw();"/>
            </div>
          </div>
          <div class="field">
            <label class="label">Horizontal Margin</label>
            <div class="control">
              <input class="input" id="margin-horizontal-input" type="number" min="0" max="30" value="10" oninput="draw();"/>
            </div>
          </div>
          <div class="field">
            <label class="label">Gutter</label>
            <div class="control">
              <input class="input" id="gutter-input" type="number" min="0" max="30" value="10" oninput="draw();"/>
            </div>
          </div>
        </div>
        <div class="column">
          <center>
            <img src="layout.svg" width="400">
          </center>
        </div>
      </div>

      <svg id="diagram-outside"></svg>
      <svg id="diagram-inside"></svg>
      <p><strong>Outside:</strong> <span id="desc-outside"></p>
      <p><strong>Inside:</strong> <span id="desc-inside"></p>
    </section>

    <script>
      const pagew_input = document.getElementById('page-width-input');
      const pageh_input = document.getElementById('page-height-input');
      const hmargin_input = document.getElementById('margin-horizontal-input');
      const vmargin_input = document.getElementById('margin-vertical-input');
      const gutter_input = document.getElementById('gutter-input');
      const desc_outside = document.getElementById('desc-outside');
      const desc_inside = document.getElementById('desc-inside');

      function describe(layout) {
        let s = "";
        s += `Folds at ${layout.folds.map(s => s + 'mm').join(' and ')}. `;
        let a = layout.panels.flatMap(p => [p.x, p.x + p.w]);
        s += `Vertical rulers at ${a.map(s => s + 'mm').join(', ')}. `;
        let p = layout.panels[0]
        s += `Horizontal rulers at ${p.y}mm and ${p.y + p.h}mm.`;
        return s;
      }

      function draw() {
        let layout = new Layout();
        layout.pageWidth = parseInt(pagew_input.value, 10);
        layout.pageHeight = parseInt(pageh_input.value, 10);
        layout.hmargin = parseInt(hmargin_input.value, 10);
        layout.vmargin = parseInt(vmargin_input.value, 10);
        layout.gutter = parseInt(gutter_input.value, 10);

        drawMetrics('#diagram-outside', getOutsideMetrics(layout), true);
        desc_outside.innerHTML = describe(layout);
        drawMetrics('#diagram-inside', getInsideMetrics(layout), false);
        desc_inside.innerHTML = describe(layout);
      }
    </script>
  </body>
</html>
